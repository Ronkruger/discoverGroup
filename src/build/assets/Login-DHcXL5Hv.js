import{a,u as L,p as P,j as e,L as R}from"./index-7zN7D-LI.js";const y="http://localhost:4000";function V(){const[i,j]=a.useState(""),[c,w]=a.useState(""),[d,n]=a.useState(""),[u,m]=a.useState(!1),[f,S]=a.useState(!1),[v,h]=a.useState(!1),[g,b]=a.useState(!1),[x,o]=a.useState(""),l=L(),{setUser:N,user:p}=P();a.useEffect(()=>{p&&l("/")},[p,l]);async function E(s){s.preventDefault(),m(!0),n(""),h(!1),o("");try{const t=await fetch(`${y}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,password:c})}),r=await t.json();if(!t.ok)throw r.requiresVerification&&h(!0),new Error(r.error||"Login failed");console.log("Login successful:",r),localStorage.setItem("token",r.token),localStorage.setItem("user",JSON.stringify(r.user)),N(r.user),console.log("User set in context:",r.user),l("/")}catch(t){t instanceof Error?n(t.message):n(String(t))}finally{m(!1)}}async function k(){b(!0),o(""),n("");try{const s=await fetch(`${y}/auth/resend-verification`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i})}),t=await s.json();if(!s.ok)throw new Error(t.error||"Failed to resend email");o(t.message||"Verification email sent! Please check your inbox.")}catch(s){s instanceof Error?n(s.message):n(String(s))}finally{b(!1)}}return e.jsxs("div",{className:"max-w-md mx-auto mt-12 p-6 bg-white rounded shadow",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Client Login"}),d&&e.jsxs("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 text-red-600 rounded",children:[d,v&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{onClick:k,disabled:g,className:"text-sm bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:g?"Sending...":"Resend Verification Email"})})]}),x&&e.jsx("div",{className:"mb-3 p-3 bg-green-50 border border-green-200 text-green-600 rounded",children:x}),e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Email"}),e.jsx("input",{type:"email",className:"w-full border rounded px-3 py-2",value:i,onChange:s=>j(s.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1 font-medium",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:f?"text":"password",className:"w-full border rounded px-3 py-2 pr-10",value:c,onChange:s=>w(s.target.value),required:!0}),e.jsx("button",{type:"button",className:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-500",tabIndex:-1,onClick:()=>S(s=>!s),children:f?"ğŸ™ˆ":"ğŸ‘ï¸"})]})]}),e.jsx("button",{type:"submit",className:"w-full bg-blue-600 text-white py-2 rounded font-semibold",disabled:u,children:u?"Logging in...":"Login"})]}),e.jsxs("div",{className:"mt-4 text-sm text-center",children:["Don't have an account?"," ",e.jsx(R,{to:"/register",className:"text-blue-600 hover:underline",children:"Register"})]})]})}export{V as default};
